(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[302],{5974:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/historial",function(){return o(7471)}])},8392:function(e,t,o){"use strict";var r=o(5893),a=o(7294),n=o(1163);let s=e=>t=>{let o=(0,n.useRouter)();return(0,a.useEffect)(()=>{localStorage.getItem("token")||o.replace("/login")},[o]),(0,r.jsx)(e,{...t})};s.displayName="withAuth",t.Z=s},7471:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return _}});var r=o(5893),a=o(4119),n=o(7462),s=o(3366),c=o(7294),i=o(512),u=o(3390),l=o(6523),d=o(9707),h=o(6682);let p=["className","component"];var f=o(7078),m=o(7297),x=o(2453);let b=(0,o(1588).Z)("MuiBox",["root"]),g=(0,m.Z)(),w=function(e={}){let{themeId:t,defaultTheme:o,defaultClassName:a="MuiBox-root",generateClassName:f}=e,m=(0,u.default)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(l.Z);return c.forwardRef(function(e,c){let u=(0,h.Z)(o),l=(0,d.Z)(e),{className:x,component:b="div"}=l,g=(0,s.Z)(l,p);return(0,r.jsx)(m,(0,n.Z)({as:b,ref:c,className:(0,i.Z)(x,f?f(a):a),theme:t&&u[t]||u},g))})}({themeId:x.Z,defaultTheme:g,defaultClassName:b.root,generateClassName:f.Z.generate});var y=o(9320),j=o(7813),T=e=>{let{area:t,user:o,date:a,click:n}=e;return(0,r.jsxs)(w,{sx:{height:"auto",width:"70%",borderRadius:3,padding:3,boxShadow:"0px 4px 4px rgba(0, 0, 0, 0.25)",marginTop:3,marginLeft:3,cursor:"pointer",background:"#F3FFFE"},onClick:n,children:[(0,r.jsx)(y.Z,{fontStyle:"normal",fontWeight:"700",fontSize:"23px",children:t||"\xc1rea desconocida"}),(0,r.jsxs)(w,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:4},children:[(0,r.jsxs)(w,{sx:{display:"flex",width:300},children:[(0,r.jsx)(j.Z,{nombre:o||"Usuario desconocido"}),(0,r.jsx)(y.Z,{sx:{marginLeft:2},children:o||"Usuario desconocido"})]}),(0,r.jsx)(y.Z,{children:a||"Fecha desconocida"})]})]})},C=o(1220),Z=o(1163),_=(0,o(8392).Z)(()=>{let[e,t]=(0,c.useState)([]),[o,n]=(0,c.useState)(null),[s,i]=(0,c.useState)({}),u=(0,Z.useRouter)();(0,c.useEffect)(()=>{let e=async()=>{try{let e=(0,C.e)("csrftoken"),o=localStorage.getItem("token"),r=await fetch("".concat("http://localhost:8000","/HistorialPresupuesto/"),{method:"GET",headers:{"X-CSRFToken":e,Authorization:"Token ".concat(o),"Content-Type":"application/json"},credentials:"include"});if(localStorage.removeItem("rubrosData"),localStorage.removeItem("selectedPresupuesto"),!r.ok)throw Error("HTTP error! Status: ".concat(r.status));let a=(await r.json()).map(e=>({id:e.id,usuario:e.usuario,uen:e.uen,centroCostoid:e.cuenta,rubro:e.rubro,subrubro:e.subrubro,item:e.item,meses:e.meses,value:e.presupuestomes,fecha:e.fecha,rubrosTotals:e.rubrosTotals,updatedRubros:e.updatedRubros,monthlyTotals:e.monthlyTotals}));t(a||[])}catch(e){console.error("Error fetching data:",e)}};o||e()},[o]);let l=t=>{let o=e.filter(e=>e.uen.nombre.toLowerCase()===t.toLowerCase());if(o.length>0){let e={};o.forEach(t=>{let{id:o,usuario:r,uen:a,centroCostoid:n,rubro:s,subrubro:c,item:i,meses:u,value:l,rubrosTotals:d,updatedRubros:h,monthlyTotals:p}=t;e["outlined-basic-".concat(s,"-").concat(c,"-").concat(i,"-").concat(u)]={id:o,usuario:r,uen:a,centroCostoid:n,rubro:s,subrubro:c,item:i,meses:u,value:l,rubrosTotals:d,updatedRubros:h,monthlyTotals:p}}),i(e);let r=o.map(e=>e.updatedRubros),a=o.map(e=>e.monthlyTotals),n=o.map(e=>e.rubrosTotals),s=o.map(e=>e.centroCostoid),c=o.map(e=>e.id),l={};Object.keys(e).forEach(t=>{let o=e[t];l[t]={id:o.id,value:o.value,centroCostoid:o.centroCostoid}}),localStorage.setItem("".concat("Unidades de Apoyo"===t?"unidad-apoyo":t.toLowerCase(),"_selectedPresupuesto"),JSON.stringify({inputs:l,centroCostoid:s,id:c,rubrosTotals:n[n.length-1],updatedRubros:r[r.length-1],monthlyTotals:a[a.length-1]}));let d="Unidades de Apoyo"===t?"unidad-apoyo":t.toLowerCase();u.push("/uen/".concat(d))}else console.error("No se encontraron presupuestos para la UEN seleccionada")},d=Array.from(new Map(e.map(e=>["".concat(e.uen.nombre,"-").concat(e.usuario.first_name),e])).values());return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"row",height:"100vh"},children:[(0,r.jsx)(a.Z,{}),(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"80%"},children:d.length>0&&d.map((e,t)=>(0,r.jsx)(T,{area:"".concat(e.uen.nombre||"N/A"),user:"".concat(e.usuario.first_name," ").concat(e.usuario.last_name),date:"".concat(e.fecha||"N/A"),click:()=>l(e.uen.nombre)},t))})]})})})},1220:function(e,t,o){"use strict";o.d(t,{e:function(){return r}});let r=e=>{let t="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===t.length)return t.pop().split(";").shift()}}},function(e){e.O(0,[319,920,119,888,774,179],function(){return e(e.s=5974)}),_N_E=e.O()}]);