(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[570],{8392:function(e,o,t){"use strict";var r=t(5893),n=t(7294),a=t(1163);let s=e=>o=>{let t=(0,a.useRouter)();return(0,n.useEffect)(()=>{localStorage.getItem("token")||t.replace("/login")},[t]),(0,r.jsx)(e,{...o})};s.displayName="withAuth",o.Z=s},8066:function(e,o,t){"use strict";t.d(o,{Z:function(){return _}});var r=t(5893),n=t(7294),a=t(3736),s=t(5985),i=t(8774),l=t(882),c=t(920),d=t(9233),u=t(7838),b=t(9320),h=t(6),m=t(6596),p=t(4259),x=t(5422),g=t(4766),y=t(4556),j=t(1651),f=t(8811),C=t(6195),v=t(4902),S=t(256),Z=t(2521),k=e=>{let{onRemove:o}=e;return(0,r.jsx)("div",{style:{position:"relative"},children:(0,r.jsx)("button",{style:{opacity:0,transition:"opacity 0.3s ease",background:"none",border:"none"},onMouseEnter:e=>e.currentTarget.style.opacity=1,onMouseLeave:e=>e.currentTarget.style.opacity=0,onClick:o,children:(0,r.jsx)(Z.Z,{color:"error"})})})},w={speedDial:(e,o)=>({position:"fixed",bottom:e?8:16,right:e?8:16,opacity:o,transition:"opacity 0.3s"}),table:{border:"none",borderRadius:"6px 6px 0 0",background:"rgb(253, 128, 2, 0.85)",color:"white"},tableInmobiliaria:{border:"none",borderRadius:"6px 6px 0 0",background:"rgb(0, 45, 175, 0.85)",color:"white"},tableUA:{border:"none",borderRadius:"6px 6px 0 0",background:"rgb(138, 138, 135, 0.85)",color:"white"},tableConstructora:{border:"none",borderRadius:"6px 6px 0 0",background:"rgb(75, 134, 128, 0.85)",color:"white"},tableHeader:{width:"400px"},monthHeader:{width:"100px"},accordionSummary:{background:"rgb(253, 128, 2)",color:"white"},accordionSummaryInmobiliaria:{background:"rgb(0, 45, 175)",color:"white"},accordionSummaryUA:{background:"rgb(138, 138, 135)",color:"white"},accordionSummaryConstructora:{background:"rgb(75, 134, 128)",color:"white"},subAccordionSummary:{background:"rgba(253, 128, 2, 0.85)",color:"white"},subAccordionSummaryInmobiliaria:{background:"rgba(0, 45, 175, 0.85)",color:"white"},subAccordionSummaryUA:{background:"rgba(138, 138, 135, 0.85)",color:"white"},subAccordionSummaryConstructora:{background:"rgba(75, 134, 128, 0.85)",color:"white"},itemCell:{width:"350px",display:"flex",flexDirection:"row",justifyContent:"space-between",marginLeft:"16px"},input:{width:"97px",boxSizing:"border-box",borderRadius:4},dialogButton:{width:"100%",background:"white",border:"none",cursor:"pointer"},tableContainer:{width:"100%",marginTop:"5px",marginBottom:"20px",border:"1px solid #ccc",borderRadius:4},tableCell:{textAlign:"left",padding:"8px"},totalCell:e=>({textAlign:"left",padding:"8px",color:e>=0?"green":"red"})},A=t(1220),I=t(7483),T=t(3339),E=t(4105),R=t(1163),_=e=>{var o;let{MONTHS:t,rubrosTotals:Z,setRubrosTotals:_,setInputValues:D,inputValues:O,updatedRubros:M,setUpdatedRubros:N,uen:P,setMonthlyTotals:F,monthlyTotals:z,updatedcentroCostos:H,userId:B,CentroCostoid:J,setCentroCostoid:L}=e,[U,q]=(0,n.useState)(!1),[G,X]=(0,n.useState)(""),[V,K]=(0,n.useState)(""),[Q,W]=(0,n.useState)(""),[Y,$]=(0,n.useState)(!1),[ee,eo]=(0,n.useState)(.5),[et,er]=(0,n.useState)(!1),[en,ea]=(0,n.useState)(""),[es,ei]=(0,n.useState)("success"),[el,ec]=(0,n.useState)(!1),ed=(0,u.Z)("(max-width:600px)"),eu=()=>q(!0),eb=()=>q(!1),eh=(0,n.useRef)(null),em=(0,R.useRouter)(),ep=em.pathname.split("/")[2];(0,n.useEffect)(()=>{let e=setTimeout(()=>{localStorage.setItem("".concat(ep,"_rubrosData"),JSON.stringify({updatedRubros:M,monthlyTotals:z,rubrosTotals:Z,inputs:O}))},500);return()=>clearTimeout(e)},[ep,M,z,Z,O]);let ex=(e,o,t,r)=>{var n;let a=parseFloat(e)||0,s=a-((null===(n=O[r])||void 0===n?void 0:n.value)||0);localStorage.removeItem("".concat(ep,"_selectedPresupuesto")),D(e=>{var o;return{...e,[r]:{value:a,centroCostoid:J||localStorage.getItem("".concat(ep,"_CentroCostoid")),id:(null===(o=e[r])||void 0===o?void 0:o.id)||parseInt(r.split("-")[3])}}}),F(e=>{let t=[...e];return t[o]=(t[o]||0)+s,t}),_(e=>{let r={...e};return r[t]||(r[t]=Array(12).fill(0)),r[t][o]=(r[t][o]||0)+s,r})},eg=async(e,o,r)=>{let n=[...M];n[e].subrubros[o].items.splice(r,1);let a={...O};Object.keys(a).forEach(t=>{let[n,s,i,l,c]=t.split("-");parseInt(i)===e&&parseInt(l)===o&&parseInt(c)===r&&delete a[t]});let s=[...z],i={...Z};t.forEach((t,a)=>{var l;let c=parseFloat(null===(l=O["outlined-basic-".concat(e,"-").concat(o,"-").concat(r,"-").concat(a)])||void 0===l?void 0:l.value)||0;s[a]-=c,i[n[e].nombre]&&(i[n[e].nombre][a]-=c)}),i[n[e].nombre]&&i[n[e].nombre].every(e=>0===e)&&delete i[n[e].nombre];let l=Object.keys(O).map(e=>({id:parseInt(O[e].id)})),c=(0,A.e)("csrftoken"),d=localStorage.getItem("token"),u=await fetch("".concat("http://localhost:8000","/presupuestos/batch-delete/"),{method:"DELETE",headers:{"X-CSRFToken":c,"Content-Type":"application/json",Authorization:"Token ".concat(d)},body:JSON.stringify(l)});localStorage.removeItem("".concat(ep,"_rubrosData")),localStorage.removeItem("".concat(ep,"_selectedPresupuesto")),u.ok?(ea("Presupuesto eliminado exitosamente."),ei("success"),er(!0),N(n),D(a),F(s),_(i)):console.error("Error al eliminar el \xedtem")},ey=e=>e.reduce((e,o)=>e+o,0),ej=()=>{er(!1)},ef=async e=>{let o=e.target.files[0];if(o){let e=await o.arrayBuffer(),t=E.ij(e),r=t.SheetNames[0],n=t.Sheets[r];eC(E.P6.sheet_to_json(n,{header:1}))}},eC=e=>{let o={...O},t=[...z],r={...Z};for(let n=1;n<e.length;n++){let a=e[n],s=a[0],i=a[1],l=a[2].split(" "),c=l[0],d=l.slice(1).join(" "),u=a[3],b=a.slice(4,16);if(b.every(e=>0===e||null===e))continue;let h=M.find(e=>e.nombre===i);h||(h={nombre:i,subrubros:[]},M.push(h));let m=h.subrubros.find(e=>e.codigo.toString()===c&&e.nombre===d);m||(m={codigo:c,nombre:d,items:[]},h.subrubros.push(m)),m.items=m.items||[];let p={nombre:u};b.forEach((e,n)=>{let a=e||0;if(0!==a){let e="outlined-basic-".concat(M.indexOf(h),"-").concat(h.subrubros.indexOf(m),"-").concat(m.items.length,"-").concat(n);o[e]={value:a,centroCostoid:s},r[i]||(r[i]=Array(12).fill(0)),r[i][n]+=a,t[n]+=a,p[e]=a}}),Object.keys(p).length>1&&m.items.push(p)}N([...M]),D(o),_(r),F(t)},ev=async()=>{let e=(0,A.e)("csrftoken"),o=localStorage.getItem("token"),t=Object.keys(O).map(e=>{let[o,t,r,n,a,s]=e.split("-"),i=O[e],l=parseFloat((null==i?void 0:i.value)||0);return{id:parseInt(i.id),usuario:B,uen:P,cuenta:parseInt(i.centroCostoid),rubro:parseInt(r),subrubro:parseInt(n),item:parseInt(a),meses:parseInt(s),presupuestomes:isNaN(l)?0:l,updatedRubros:M,rubrosTotals:Z,monthlyTotals:z}});try{let r=await fetch("".concat("http://localhost:8000","/presupuestos/batch-update/"),{method:"PATCH",headers:{"X-CSRFToken":e,Authorization:"Token ".concat(o),"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(localStorage.removeItem("".concat(ep,"_rubrosData")),localStorage.removeItem("".concat(ep,"_selectedPresupuesto")),r.ok){let{created:e,updated:o}=await r.json();ea("Presupuesto actualizado exitosamente. ".concat(o," actualizados, ").concat(e," creados.")),ei("success"),er(!0)}else throw Error("Error in response")}catch(e){ea("Error al actualizar el presupuesto."),ei("error"),er(!0)}finally{er(!0),setTimeout(()=>{window.location.reload()},500)}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{marginLeft:5},children:[(0,r.jsxs)("table",{style:w.tableContainer,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:w.tableCell,children:(0,r.jsx)(b.Z,{children:"Rubro/Mes"})}),["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map((e,o)=>(0,r.jsx)("th",{style:w.tableCell,children:(0,r.jsx)(b.Z,{children:e})},o)),(0,r.jsx)("th",{style:w.tableCell,children:(0,r.jsx)(b.Z,{children:"Total Anual"})})]})}),(0,r.jsxs)("tbody",{children:[Object.entries(Z).map((e,o)=>{let[t,n]=e;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{style:w.tableCell,children:(0,r.jsx)(b.Z,{children:t})}),n.map((e,o)=>(0,r.jsx)("td",{style:w.totalCell(e),children:(0,r.jsx)(b.Z,{children:Math.round(e)})},o)),(0,r.jsx)("td",{style:w.totalCell(ey(n)),children:(0,r.jsx)(b.Z,{children:Math.round(ey(n))})})]},o)}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{style:w.tableCell,children:(0,r.jsx)(b.Z,{children:"Total General"})}),z.map((e,o)=>(0,r.jsx)("td",{style:w.totalCell(e),children:(0,r.jsx)(b.Z,{children:Math.round(e)})},o)),(0,r.jsx)("td",{style:w.totalCell(ey(z)),children:(0,r.jsx)(b.Z,{children:Math.round(ey(z))})})]})]})]}),(0,r.jsx)("table",{style:"/uen/constructora"===em.pathname?w.tableConstructora:"/uen/inmobiliaria"===em.pathname?w.tableInmobiliaria:"/uen/unidad-apoyo"===em.pathname?w.tableUA:w.table,children:(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:w.tableHeader,children:(0,r.jsx)(b.Z,{children:"Rubro"})}),t.map((e,o)=>(0,r.jsx)("th",{style:w.monthHeader,children:(0,r.jsxs)(b.Z,{children:[e," 24"]})},o))]})})}),M.map((e,o)=>(0,r.jsxs)(h.Z,{children:[(0,r.jsx)(m.Z,{expandIcon:(0,r.jsx)(a.Z,{}),"aria-controls":"panel".concat(o,"-content"),id:"panel".concat(o,"-header"),sx:"/uen/constructora"===em.pathname?w.accordionSummaryConstructora:"/uen/inmobiliaria"===em.pathname?w.accordionSummaryInmobiliaria:"/uen/unidad-apoyo"===em.pathname?w.accordionSummaryUA:w.accordionSummary,children:(0,r.jsx)(b.Z,{children:e.nombre})}),e.subrubros.map((n,s)=>(0,r.jsxs)(h.Z,{children:[(0,r.jsx)(m.Z,{expandIcon:(0,r.jsx)(a.Z,{}),"aria-controls":"panel".concat(o,"-").concat(s,"-content"),id:"panel".concat(o,"-").concat(s,"-header"),sx:"/uen/constructora"===em.pathname?w.subAccordionSummaryConstructora:"/uen/inmobiliaria"===em.pathname?w.subAccordionSummaryInmobiliaria:"/uen/unidad-apoyo"===em.pathname?w.subAccordionSummaryUA:w.subAccordionSummary,children:(0,r.jsx)(b.Z,{children:"".concat(n.codigo," ").concat(n.nombre)})}),M[o]&&M[o].subrubros&&M[o].subrubros[s]&&M[o].subrubros[s].items&&M[o].subrubros[s].items.length>0?(0,r.jsx)("table",{style:{width:"500px"},children:(0,r.jsx)("tbody",{children:M[o].subrubros[s].items.map((n,a)=>(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{style:w.itemCell,children:[(0,r.jsx)(b.Z,{children:n.nombre}),(0,r.jsx)(k,{onRemove:()=>eg(o,s,a)})]}),t.map((t,n)=>{var i;let l="outlined-basic-".concat(o,"-").concat(s,"-").concat(a,"-").concat(n);return(0,r.jsx)("td",{children:(0,r.jsx)("input",{type:"number",id:l,style:w.input,value:(null===(i=O[l])||void 0===i?void 0:i.value)||"",onChange:o=>ex(o.target.value,n,e.nombre,l)})},n)})]},a))})}):(0,r.jsx)("div",{style:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center",height:40},children:(0,r.jsx)(b.Z,{sx:{color:"#ABABAB"},children:"No hay centro de costo creado"})}),(0,r.jsx)("button",{style:w.dialogButton,onClick:eu,children:(0,r.jsx)(d.Z,{})})]},s))]},o))]}),(0,r.jsx)("input",{type:"file",accept:".xlsx, .xls",ref:eh,onChange:ef,style:{display:"none"}}),(0,r.jsx)(I.Z,{open:et,autoHideDuration:6e3,onClose:()=>er(!1),children:(0,r.jsx)(T.Z,{onClose:()=>er(!1),severity:es,children:en})}),(0,r.jsx)(I.Z,{open:et,autoHideDuration:6e3,onClose:ej,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,r.jsx)(T.Z,{onClose:ej,severity:es,sx:{width:"100%"},children:en})}),(0,r.jsxs)(p.Z,{ariaLabel:"SpeedDial basic example",sx:w.speedDial(ed,ee),icon:(0,r.jsx)(i.Z,{}),onMouseEnter:()=>{eo(1)},onMouseLeave:()=>{eo(.5)},children:[(0,r.jsx)(x.Z,{icon:(0,r.jsx)(l.Z,{}),tooltipTitle:"Descargar archivo",onClick:()=>{let e=E.P6.book_new(),o=[],r=["Id","Rubros","Subrubros","Centro De Costos","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];o.push(r),M.forEach(e=>{Array.isArray(e.subrubros)&&e.subrubros.forEach(r=>{Array.isArray(r.items)&&r.items.forEach((n,a)=>{let s=n.centroCostoid,i="".concat(r.codigo," ").concat(r.nombre),l=[s,e.nombre,i,n.nombre];t.forEach((o,t)=>{var n;let s="outlined-basic-".concat(M.indexOf(e),"-").concat(e.subrubros.indexOf(r),"-").concat(a,"-").concat(t);l.push((null===(n=O[s])||void 0===n?void 0:n.value)||0)}),o.push(l)})})});let n=E.P6.aoa_to_sheet(o),a=r.map((e,t)=>Math.max(e.length,...o.map(e=>e[t]?e[t].toString().length:0)));n["!cols"]=a.map(e=>({wch:e+2})),E.P6.book_append_sheet(e,n,"Rubros"),E.NC(e,"".concat(P,".xlsx")),setTimeout(()=>{localStorage.removeItem("".concat(ep,"_rubrosData")),localStorage.removeItem("".concat(ep,"_selectedPresupuesto")),window.location.reload()},500)}},"Download"),(0,r.jsx)(x.Z,{icon:(0,r.jsx)(c.Z,{}),tooltipTitle:"Subir archivo",onClick:()=>{eh.current.click()}},"Upload"),(0,r.jsx)(x.Z,{icon:(0,r.jsx)(s.Z,{}),tooltipTitle:"Guardar",onClick:ev,disabled:el},"Save")]}),(0,r.jsxs)(g.Z,{open:U,onClose:eb,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,r.jsx)(y.Z,{id:"alert-dialog-title",children:"Crear centro de costos"}),(0,r.jsxs)(j.Z,{children:[(0,r.jsx)(f.Z,{options:M.map(e=>e.nombre),sx:{width:300,marginTop:5},renderInput:e=>(0,r.jsx)(C.Z,{...e,label:"Rubro"}),onChange:(e,o)=>{o?X(o):console.error("Rubro no seleccionado")}}),G&&(0,r.jsx)(f.Z,{options:(null===(o=M.find(e=>e.nombre===G))||void 0===o?void 0:o.subrubros.map(e=>({label:"".concat(e.codigo," ").concat(e.nombre),id:e.id})))||[],getOptionLabel:e=>e.label,isOptionEqualToValue:(e,o)=>e.id===o.id,sx:{width:300,marginTop:5},renderInput:e=>(0,r.jsx)(C.Z,{...e,label:"Subrubro"}),onChange:(e,o)=>{o?K(o.label):console.error("Subrubro no seleccionado")}}),V&&(Array.isArray(H)&&H.length>0?(0,r.jsx)(f.Z,{options:H.map(e=>"".concat(e.codigo," ").concat(e.nombre," ").concat(e.regional.nombre))||[],sx:{width:300,marginTop:5},renderInput:e=>(0,r.jsx)(C.Z,{...e,label:"Centro Costos"}),onChange:(e,o)=>{if(o){let e=H.find(e=>"".concat(e.codigo," ").concat(e.nombre," ").concat(e.regional.nombre)===o);e?L(e.id):console.error("Centro de costos no encontrado o no v\xe1lido"),W(o)}else console.error("Centro de costos no seleccionado"),W("")}}):(0,r.jsx)(b.Z,{sx:{display:"flex",justifyContent:"center",mt:3,alignItems:"center"},children:"No Hay Centro De Costos habilitados"}))]}),(0,r.jsxs)(v.Z,{children:[(0,r.jsx)(S.Z,{onClick:eb,children:"Cancelar"}),(0,r.jsx)(S.Z,{onClick:()=>{if(!G||!V||!Q||!J){console.error("Faltan valores requeridos: Rubro, Subrubro o Centro de Costos");return}let e=M.findIndex(e=>e.nombre===G);if(-1!==e){Array.isArray(M[e].subrubros)||(M[e].subrubros=[]);let o=M[e].subrubros.findIndex(e=>"".concat(e.codigo," ").concat(e.nombre)===V);if(-1!==o&&""!==Q.trim()){let t=[...M];Array.isArray(t[e].subrubros[o].items)||(t[e].subrubros[o].items=[]),t[e].subrubros[o].items.push({nombre:Q,centroCostoid:J}),N(t),W("")}else console.error("Subrubro no encontrado o valor inv\xe1lido")}else console.error("Rubro no encontrado");$(!0),q(!1)},"aria-hidden":!1,autoFocus:!0,children:"Aceptar"})]})]})]})}},1220:function(e,o,t){"use strict";t.d(o,{e:function(){return r}});let r=e=>{let o="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===o.length)return o.pop().split(";").shift()}},67:function(){},2061:function(){}}]);